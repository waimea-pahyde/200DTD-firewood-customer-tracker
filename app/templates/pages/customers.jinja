{#=====================================================
  Things list page
  - List of things passed in as 'things' array
  - Form for adding a new thing
=====================================================#}

{% extends 'pages/base.jinja' %}


{% block title %}

    Customer List

{% endblock %}


{% block content %}

    <article id="intro">
    <h1>Customer Data</h1>
    </article>






 

{# Pie Chart Stuff - Move to wood page.  #}
<article id="backgroundPieChart">

{# <img src="/static/images/piechart.png" id="image"> #}

<div style="width: 800px;">
    <canvas id="wood-chart"></canvas>
</div>

<article id="textBackground">
  {% for wood in woods%}
    <p>{{wood.type}} : {{wood.total}}</p>
{%endfor%}

</article>

</article>


{# The custoemrs list - Don't move this #}
  <article>
   {# Search functions #}
  
  <form method="POST" action="/search">         
    <input
    type="search"
  name="search"
  placeholder="Search"
  aria-label="Search"
  id="search" 
  onchange="this.form.submit()"/>
  </form>

  {%for result in results%}
    <a href="/customer/{{result.id}}">
    {{result.name}}
    </a>
    <br>

  {%endfor%}
        
        
        <H2>Cutomers:</H2>
        <ul>
            {% for customer in customers %}

                <li>
                    <a href="/customer/{{ customer.id }}">
                        {{ customer.name }}
                    </a>

                    <ul>
                        {% for order in orders %}
                            {% if customer.id == order.cid %}
                                <li>
                                    <a href="/order/{{ order.id }}">
                                         {{ order.date  }}
                                    </a>
                                </li>
                            {% endif %}
                        {% else %}
                            <li>NONE</li>
                        {% endfor %}
                    </ul>
                </li>

            {% else %}

                <p>None!</p>

            {% endfor %}
        </ul>

    </article>

<script>
const data = [

    {# Generating the JSON data for the chart #}
    
    {% for wood in woods %}

        { type: "{{ wood.type }}", count: {{ wood.total }} },

    {%endfor %}

  ];

new Chart(
    document.getElementById('wood-chart'),
    {
      type: 'pie',
      data: {
        labels: data.map(row => row.type),
        datasets: [
          {
            label: 'Wood by Type',
            data: data.map(row => row.count)
          }
        ]
      }
    }
  )
</script> 

{% endblock %}

